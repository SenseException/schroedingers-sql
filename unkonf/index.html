<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="../node_modules/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="../node_modules/reveal.js/css/theme/simple.css" id="theme">
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="../node_modules/reveal.js/lib/css/zenburn.css">
    <link rel="stylesheet" media="print" href="../node_modules/reveal.js/css/print/pdf.css">
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-background="../images/title.jpg" class="top">
            <div class="bg">
                <h1>Schr√∂dinger's SQL</h1>
                <h4>The SQL inside the ORM/Builder box</h4>
            </div>
        </section>

        <section>
            <div style="text-align: left">
                Claudio Zizza<br><br>
                Developer for > 18 years<br>
                (Currently PHP)<br><br>
                Organizing PHP Usergroup Karlsruhe<br><br>
                Part of Doctrine: <a rel="nofollow noreferrer" target="_blank" href="https://www.doctrine-project.org">doctrine-project.org</a><br>
                Part of Podcast: <a rel="nofollow noreferrer" target="_blank" href="http://phpdevradio.de">phpdevradio.de</a><br>
                PHP Snippets: <a rel="nofollow noreferrer" target="_blank" href="https://php.budgegeria.de">php.budgegeria.de</a><br><br>
                Twitter: <a rel="nofollow noreferrer" target="_blank" href="https://twitter.com/senseexception">@SenseException</a>
            </div>
        </section>

        <section>
            <h2>Who has a big customer-project <strong>without</strong> a database?</h2>
        </section>

        <section>
            <img src="../images/list-of-results.png" height="817" width="673">
        </section>

        <section>
            <img src="../images/list-of-results2.png" height="821" width="674">
        </section>

        <section>
            <h2>Microsoft Access 2000</h2>
        </section>

        <section>
            <h1 style="width: 500px; margin: auto">
                <span data-fragment-index="1" class="fragment grow" style="float: left">S</span>
                <span data-fragment-index="4" class="fragment fade-out" style="float: left">E</span>
                <span data-fragment-index="2" class="fragment grow" style="float: left">Q</span>
                <span data-fragment-index="4" class="fragment fade-out" style="float: left">UE</span>
                <span data-fragment-index="3" class="fragment grow" style="float: left">L</span>
            </h1>
            <h3 data-fragment-index="4" class="fragment fade-up" style="clear: both; padding-top: 50px">Structured Query Language</h3>
            <aside class="notes">
                By 1974, Donald Chamberlin and Raymond Boyce published SEQUEL: A Structured English Query Language.
                Easy to learn, even for non-techies. Later renamed to SQL by dropping some letters, because of legal problems.
                "SEQUEL" was a trademark of the UK-based Hawker Siddeley aircraft company.
                Became a standard of the American National Standards Institute (ANSI) in 1986 and
                International Organization for Standardization (ISO) in 1987.
            </aside>
        </section>

        <section class="top">
            <h3>ISO/IEC 9075</h3>
            <ul class="fragment fade-right">
                <li>SQL-86 (or SQL-87)</li>
                <li>SQL-89</li>
                <li>SQL-92</li>
                <li>SQL:1999</li>
                <li>SQL:2003</li>
                <li>SQL:2006</li>
                <li>SQL:2008</li>
                <li>SQL:2011</li>
                <li>SQL:2016</li>
            </ul>
        </section>

        <section>
            <pre><code class="sql">
    SELECT firstname, name FROM address_book ORDER BY name;
            </code></pre>

            <p class="fragment fade-in text-small"><b>Select firstname</b> and <b>name from address book</b> and <b>order</b> them <b>by name</b></p>
        </section>

        <section>

            <table>
                <tr>
                    <th>id</th>
                    <th>firstname</th>
                    <th>name</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>John</td>
                    <td>Doe</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Jane</td>
                    <td>Doe</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Leo</td>
                    <td>Part</td>
                </tr>
            </table>

            <pre><code class="sql">
    SELECT firstname, name FROM address_book GROUP BY name;
            </code></pre>

            <p class="fragment fade-in text-red bold">ERROR: column "address_book.firstname" must appear in the GROUP BY clause or be used in an aggregate function</p>
        </section>

        <section data-background="../images/lois.png">
            <div class="bubble-container">
                <div class="bubble-pos1"><p class="bubble bubble-left">It's a PostgreSQL database.</p></div>
                <div class="bubble-pos2"><p class="bubble bubble-right fragment fade-in">No!</p></div>
                <div class="bubble-pos3"><p class="bubble bubble-left fragment fade-in">Yes!</p></div>
                <div class="bubble-pos4"><p class="bubble bubble-right fragment fade-in">Ooooh...</p></div>
            </div>
        </section>

        <section>
            <h2>Know your database!</h2>
        </section>

        <section>
            <h2>How did you learn SQL?</h2>
        </section>

        <section>
            <h2>A chapter in books</h2>
        </section>

        <section class="top">
            <div class="bg-image bg-sql-asp">
                <div class="fragment fade-in marked mark-asp-select"></div>
                <div class="fragment fade-in marked mark-asp-insert"></div>
                <div class="fragment fade-in marked mark-asp-update"></div>
            </div>
        </section>

        <section class="top">
            <div class="bg-image bg-sql-php1">
                <div class="fragment fade-in marked mark-php-select"></div>
                <div class="fragment fade-in marked mark-php-insert"></div>
                <div class="fragment fade-in marked mark-php-update"></div>
                <div class="fragment fade-in marked mark-php-group"></div>
                <div class="fragment fade-in marked mark-php-join"></div>
            </div>
        </section>

        <section class="top">
            <div class="bg-image bg-sql-php2" style="height: 10em">
                <div class="fragment fade-in marked mark-php-union"></div>
                <div class="fragment fade-in marked mark-php-table"></div>
                <div class="fragment fade-in marked mark-php-index"></div>
                <div class="fragment fade-in marked mark-php-mysql"></div>
            </div>
        </section>

        <section>
            <pre><code class="java">
    Connection conn = DriverManager
         .getConnection("jdbc:mysql://localhost/EMP", "root", "secret");
    Statement stmt = conn.createStatement();

    ResultSet rs = stmt.executeQuery("SELECT firstname, lastname FROM person");

    while(rs.next()){
        System.out.print("Hello " + rs.getString("firstname") +
            " " + rs.getString("lastname"));
    }

    rs.close();
    stmt.close();
    conn.close();
            </code></pre>
        </section>

        <section>
            <pre><code class="php">
    $db = mysql_connect('127.0.0.1'):

    $result = mysql_db_query('bar', 'SELECT id, name FROM foo', $db);
    $rowCount = mysql_num_rows($result);

    for ($rowPointer = 0; $rowPointer < $rowCount; $rowPointer++) {
        echo mysql_result($result, $rowPointer,'id') . ' contains name ' .
            mysql_result($result, $rowPointer,'name') . PHP_EOL;
    }
            </code></pre>
        </section>

        <section>
            <pre><code class="php">
    $pdo = new PDO('mysql:dbname=bar;host=127.0.0.1');

    $statement = $pdo->query('SELECT id, name FROM foo');
    $result = $statement->fetchAll();

    foreach ($result as $row) {
        echo $row['id'] . ' contains name ' . $row['name'] . PHP_EOL;
    }
            </code></pre>
        </section>

        <section>
            <pre><code class="php">
    $pdo = new PDO('mysql:dbname=bar;host=127.0.0.1');

    $statement = $pdo->query('SELECT id, name FROM foo');

    $result = $statement->fetchAll(PDO::FETCH_CLASS, Foo::CLASS);

    foreach ($result as $foo) {
        echo $foo->getId() . ' contains name ' . $foo->getName() . PHP_EOL;
    }

            </code></pre>
        </section>

        <section>
            <h2>Object-relational mapping</h2>
        </section>

        <section>
            <h3>Entity (Hibernate)</h3>
            <pre><code class="java stretch text-small">
    public class Person {
        private int id;
        private String firstname;
        private String lastname;

        public Person(String firstname, String lastname) {
            this.firstname = firstname;
            this.lastname = lastname;
        }

        public int getId() {
            return id;
        }

        public String getFirstname() {
            return firstname;
        }

        public String getLastname() {
            return lastname;
        }
    }
            </code></pre>
        </section>

        <section>
            <h3>Entity mapping (Hibernate)</h3>
            <pre><code class="xml stretch text-small">
    &lt;?xml version = "1.0" encoding = "utf-8"?&gt;
    &lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;

    &lt;hibernate-mapping&gt;
       &lt;class name="Person" table="person"&gt;

          &lt;meta attribute="class-description"&gt;
             This class contains information about a person.
           &lt;/meta&gt;

           &lt;id name="id" type="int" column="id"&gt;
             &lt;generator class="native"/&gt;
          &lt;/id&gt;

          &lt;property name="firstname" column="firstname" type="string"/&gt;
          &lt;property name="lastname" column="lastname" type="string"/&gt;
       &lt;/class&gt;
    &lt;/hibernate-mapping&gt;
            </code></pre>
        </section>

        <section>
            <h3>Entity (Doctrine)</h3>
            <pre><code class="php stretch text-small">
    use Doctrine\ORM\Mapping as ORM;

    /**
     * @ORM\Entity
     * @ORM\Table(name="foo")
     */
    class Foo
    {
        /**
         * @ORM\Column(type="integer")
         * @ORM\Id
         * @ORM\GeneratedValue(strategy="AUTO")
         */
        private $id;

        /**
         * @ORM\Column(type="string")
         */
        private $value;

        // public function __construct(string $value)
        // public function setValue(string $value) : void
        // ...
    }
            </code></pre>
        </section>


        <section>
            <h3>Insert new entity</h3>
            <h4>Hibernate</h4>
            <pre><code class="java">
    Session session = sessionFactory.openSession();
    Transaction tx = session.beginTransaction();

    Person person = new Person("John", "Doe");
    session.save(person);

    tx.commit();
            </code></pre>
            <h4>Doctrine</h4>
            <pre><code class="php">
    $person = new Person("John", "Doe");

    $entityManager->persist($person);

    $entityManager->flush();
            </code></pre>
        </section>

        <section class="top">
            <h3>Fetch entity</h3>
            <h4>Hibernate</h4>
            <pre><code class="java">
    List personList = session.createQuery("FROM Person").list();
            </code></pre>

            <h4>Doctrine</h4>
            <pre><code class="php">
    $personList = $entityManager->createQuery("SELECT p FROM Person p")
        ->getResult();
            </code></pre>
        </section>

        <section>
            <h2>ORM exists for multiple languages</h2>
        </section>

        <section class="top">
            <h3>Sequelize (JavaScript)</h3>
            <pre><code class="javascript">
    const sequelize = new Sequelize('sqlite::memory:');

    class Person extends Model {}
    Person.init({
      firstname: DataTypes.STRING,
      lastname: DataTypes.STRING,
    }, { sequelize, modelName: 'person' });
            </code></pre>

            <pre><code class="javascript">
    sequelize.sync()
      .then(() => Person.create({
        firstname: 'Jane',
        lastname: 'Doe',
      }))
      .then(janedoe => {
        // do something
      });
            </code></pre>
        </section>

        <section class="top">
            <h3>GORM (Go)</h3>
            <pre><code class="golang">
    type Person struct {
        gorm.Model
        firstname string
        lastname string `gorm:"size:255;index:lastname_idx"`
    }
            </code></pre>

            <pre><code class="golang">
    db, err := gorm.Open("sqlite3", "test.db")
    // ...
    db.Create(&Person{firstname: "Jane", lastname: "Doe"})
            </code></pre>
        </section>

        <section>
            <h1 class="fragment fade-in text-red text-border layer">Congratulations</h1>
            <div><img src="../images/orm.png" class="transparent"></div>
            <h2>+</h2>
            <div><img src="../images/sql.png" class="transparent"></div>
        </section>

        <section>
            <h2>You have doubled your problems</h2>
        </section>

        <section>
            <h2>ORM is awesome, but</h2>
            <div class="fragment fade-up margin-bottom">
                <h3>before it was:</h3>
                <ul>
                    <li>Know how to query</li>
                    <li>OOP boilerplate code</li>
                </ul>
            </div>
            <div class="fragment fade-up">
                <h3>Now it is:</h3>
                <ul>
                    <li>Know how queries look like</li>
                    <li>Know when queries happen</li>
                    <li>Know how to query</li>
                    <li>No full SQL power due to DB compatibility</li>
                </ul>
            </div>
        </section>

        <!-- Know when queries happen -->

        <section>
            <h2>Know when queries happen</h2>
        </section>

        <section class="top">
            <h3>Managed entities</h3>
            <pre><code class="php">
    $entity = new Foo('value');

    $entityManager->persist($entity);

    $entityManager->flush(); // <-- There's SQL somewhere in there
            </code></pre>

            <pre><code class="php">
    $entity = $entityManager
        ->find(Foo::class, 42); // <-- There's SQL somewhere in there

    $entity->setValue('new value');

    $entityManager->flush(); // <-- There's SQL somewhere in there
            </code></pre>
        </section>

        <section class="top">
            <h3>JPA (Java Persistence API) + Hibernate ORM</h3>

            <pre><code class="java">
    Person person = new Person("John", "Doe");
    entityManager.persist(person);
    entityManager.flush();
            </code></pre>
        </section>

        <section class="top">
            <h3>Managed entities</h3>
            
            <pre><code class="php">
    $entityManager->find(Foo::class, 42);
    
    $entityManager->getRepository(Foo::class)
        ->find(42);
    
    $entityManager->createQuery('SELECT e FROM Foo e WHERE e.id = 42')
        ->getSingleResult();
            </code></pre>
        </section>

        <section>
            <h3>Which language?</h3>
            <pre><code class="php stretch">
    $de = new Language('de');
    $en = new Language('en');
    $it = new Language('it');
    $entityManager->persist($de);
    $entityManager->persist($en);
    $entityManager->persist($it);

    $movie = new Movie('The Mutex');
    $movie->setLanguages([$de, $en, $it]);
    $entityManager->persist($movie);
    $entityManager->flush();

    $movie = $entityManager->createQuery(
            "SELECT m, l FROM Movie m
            JOIN m.languages l
            WHERE l.iso6391 = 'it' AND f.name = 'The Mutex'"
        )
        ->getResult();

    $movie[0]->getLanguages();
            </code></pre>
        </section>

        <section class="top">
            <h3>All languages</h3>

            <ul>
                <li>de</li>
                <li>en</li>
                <li>it</li>
            </ul>
        </section>
        
        <section class="top">
            <h3>Clear EntityManager/Unit Of Work</h3>

            <pre><code class="php text-small">
    $entityManager->persist($movie);
    $entityManager->flush();

    $entityManager->clear(); // <-- Clear enities from the EntityManager/Unit Of Work

    $movie = $entityManager->createQuery(
            "SELECT m, l FROM Movie m
            JOIN m.languages l
            WHERE l.iso6391 = 'it' AND f.name = 'The Mutex'"
        )
        ->getResult();

    $movie[0]->getLanguages();
            </code></pre>
        </section>

        <section class="top">
            <h3>The Entity Reloaded</h3>

            <pre><code class="php">
    $entityManager->reload($entity);
            </code></pre>

            <pre><code class="java">
    entityManager.reload(entity);
            </code></pre>
        </section>

        <!--Lazy Loading-->

        <section class="top">
            <h3>Lazy Loading</h3>

            <pre><code class="java">
    Foo foo = myentity.getFoo().getBar().getBaz();
            </code></pre>
        </section>

        <section class="top">
            <h3>Lazy Loading</h3>

            <pre><code class="php">
  $foos = $entityManager->getRepository(Foo::class)
      ->findAll(); // <-- There's SQL somewhere in there

  foreach ($foos as $foo) {
      foreach ($foo->getBars() as $bar) { // <-- There's SQL somewhere in there
          // do stuff
      }
  }
            </code></pre>
        </section>

        <section class="top">
            <h3>Lazy Loading - SQL</h3>

            <pre><code class="sql text-small">
    -- findAll() returns 3 Foo entities
    SELECT t0.id AS id_1, t0.name AS name_2 FROM foo t0
    -- Each query is one iteration for getting the Bar relations
    SELECT t0.id AS id_1, t0.name AS name_2, t0.foo_id AS foo_id_3 FROM bar t0 WHERE t0.foo_id = 1
    SELECT t0.id AS id_1, t0.name AS name_2, t0.foo_id AS foo_id_3 FROM bar t0 WHERE t0.foo_id = 2
    SELECT t0.id AS id_1, t0.name AS name_2, t0.foo_id AS foo_id_3 FROM bar t0 WHERE t0.foo_id = 3
            </code></pre>

            <aside class="notes">
                Nested loop
            </aside>
        </section>

        <!--Eager Loading-->

        <section class="top">
            <h3>Eager Loading</h3>

            <pre><code class="php">
    $foos = $entityManager->getRepository(Foo::class)
        ->findAll(); // <-- There's SQL somewhere in there

    foreach ($foos as $foo) {
        foreach ($foo->getBars() as $bar) {
            // do stuff
        }
    }
            </code></pre>
        </section>

        <section class="top">
            <h3>EAGER Loading - SQL</h3>

            <pre><code class="sql text-small">
    -- findAll() returns 3 Foo entities and joins the bar relation
    SELECT t0.id AS id_1, t0.name AS name_2, t3.id AS id_4, t3.name AS name_5, t3.foo_id AS foo_id_6
        FROM foo t0
        LEFT JOIN bar t3 ON t3.foo_id = t0.id
            </code></pre>
        </section>

        <!-- Know how queries look like -->

        <section>
            <h2>Know how queries look like</h2>
        </section>

        <section class="top">
            <h3>Same code, different SQL</h3>

            <pre><code class="sql text-small">
    SELECT t0.id AS id_1, t0.name AS name_2 FROM foo t0
    SELECT t0.id AS id_1, t0.name AS name_2, t0.foo_id AS foo_id_3 FROM bar t0 WHERE t0.foo_id = 1
    SELECT t0.id AS id_1, t0.name AS name_2, t0.foo_id AS foo_id_3 FROM bar t0 WHERE t0.foo_id = 2
    SELECT t0.id AS id_1, t0.name AS name_2, t0.foo_id AS foo_id_3 FROM bar t0 WHERE t0.foo_id = 3
            </code></pre>

            <pre><code class="sql text-small">
    SELECT t0.id AS id_1, t0.name AS name_2, t3.id AS id_4, t3.name AS name_5, t3.foo_id AS foo_id_6
        FROM foo t0
        LEFT JOIN bar t3 ON t3.foo_id = t0.id
            </code></pre>
        </section>

        <section class="top">
            <h3>Query languages</h3>
            <pre><code class="sql">
    SELECT a.firstname, a.name FROM AddressBook AS a GROUP BY a.name
            </code></pre>
        </section>

        <section class="top">
            <h3>Explicit join - One query</h3>

            <pre><code class="sql">
    FROM Foo AS f JOIN f.bars
            </code></pre>
        </section>

        <section class="top">
            <h3>Update query</h3>
            <pre><code class="golang">
    db.First(&person)
    // person fetched with name Jane Doe

    person.firstname = "John"

    db.Save(&person)
            </code></pre>

            <pre class="fragment fade-in"><code class="sql">
    UPDATE person SET firstname = 'John', lastname = 'Doe' WHERE id = 1;
            </code></pre>
        </section>

        <section class="top">
            <h3>Update query</h3>
            <pre><code class="golang">
    db.First(&person)
    // person fetched with name Jane Doe

    db.Model(&person).Updates(Person{firstname: "John"})
            </code></pre>

            <pre class="fragment fade-in"><code class="sql">
    UPDATE person SET firstname = 'John' WHERE id = 1;
            </code></pre>
        </section>

        <section class="top">
            <h3>Filter</h3>
            <pre><code class="sql">
    SELECT f FROM Entity\Foo f
            </code></pre>

            <pre class="fragment fade-in"><code class="sql">
    SELECT f0_.id AS id_0, f0_.name AS name_1 FROM foo f0_
        WHERE (f0_.deleted = 0);
            </code></pre>
        </section>

        <section>
            <h2>Why should I care about the SQL parts?</h2>
        </section>

        <section class="top">
            <pre><code class="sql text-big">
    FROM Qux AS q WHERE q.city = 'Hahnland'
            </code></pre>

            <div class="fragment fade-in">
                <h4>Full table scan</h4>
                <img src="../images/explain3.png" width="786" height="164">
            </div>

            <div class="fragment fade-in">
                <h4>Index scan</h4>
                <img src="../images/explain4.png" width="775" height="120">
            </div>
        </section>

        <section class="top">
            <pre><code class="sql text-big">
    select * from qux WHERE city = 'Hahnland';
            </code></pre>

            <div class="fragment fade-in">
                <h4>Before</h4>
                <img src="../images/explain1.png" height="117" width="850">
            </div>

            <div class="fragment fade-in">
                <h4>Next release</h4>
                <img src="../images/explain2.png" height="118" width="816">
            </div>
        </section>

        <section>
            <h2>You can't ignore indices</h2>
            <img src="../images/phonebook.png" class="transparent" width="658" height="436">
        </section>

        <section class="top">
            <h3>Slow SQL queries</h3>

            <ul>
                <li>Need more resources</li>
                <li>May lock rows / Waiting queries</li>
            </ul>
        </section>

        <section>
            <h2>An ORM query language doesn't replace SQL!</h2>
        </section>

        <section class="top">
            <h3>Query builder (C# SqlKata)</h3>
            <pre><code class="csharp">
    var queryBuilder = new Query("foo as f").Where("f.id", 1)
        .Select("f.name", "f.id", "b.name as bname", "q.stuff")
        .LeftJoin("bar as b", "b.foo_id", "f.id")
        .OrWhere("f.id", 2)
        .LeftJoin("qux as q", "q.foo_id", "f.id");  // join order?

    if (yolo) {
        queryBuilder.WhereTrue("q.moreStuff");
    }
            </code></pre>
        </section>

        <section>
            <h2>How expensive is this query builder SQL?</h2>
        </section>

        <!-- SQL -->
        <section class="top">
            <h3>Back to SQL</h3>

            <pre><code class="sql">
    SELECT name, department, revenue FROM company;
            </code></pre>
        </section>

        <section class="top">
            <h3>Window Function</h3>

            <pre><code class="sql">
    SELECT name, department,
        SUM(revenue) OVER (PARTITION BY department ORDER BY name)
        FROM company;
            </code></pre>

            <table>
                <tr>
                    <th>name</th>
                    <th>department</th>
                    <th>SUM</th>
                </tr>
                <tr>
                    <td>Albert</td>
                    <td>sales</td>
                    <td>1200</td>
                </tr>
                <tr>
                    <td>Zoe</td>
                    <td>sales</td>
                    <td>1200</td>
                </tr>
                <tr>
                    <td>Angela</td>
                    <td>development</td>
                    <td>1804</td>
                </tr>
            </table>
        </section>

        <section data-background="../images/reactionguys1.jpg">
            <h2 class="text-white">It's that new MySQL 8 feature</h2>
        </section>

        <section data-background="../images/reactionguys2.jpg">
            <h2 class="text-white">It's a SQL 2003 standard</h2>
        </section>

        <section>
            <img src="../images/t-postgresql.png" alt="PostgreSQL Tweet about Window Functions" height="266" width="634">
        </section>

        <section class="top">
            <h3>Values List</h3>

            <pre><code class="sql">
    VALUES ('value1', 42, 1.8), ('value2', 12, 9);
            </code></pre>
        </section>

        <section class="top">
            <h3>Values List in DB Versions</h3>

            <ul>
                <li class="fragment fade-left">PostgreSQL: Yes - 8.2 (and earlier)</li>
                <li class="fragment fade-left">MariaDB: Yes - 10.3</li>
                <li class="fragment fade-left">MySQL: 8.0.19 (But with ROW syntax)</li>
                <li class="fragment fade-left">SQL-92</li>
            </ul>
        </section>

        <section class="top">
            <h3>Partially implemented</h3>

            <pre><code class="sql">
    INSERT INTO foo VALUES ('value1', 42, 1.8), ('value2', 12, 9);
            </code></pre>
        </section>

        <section class="top">
            <h3>Column name alias</h3>

            <pre><code class="sql">
    SELECT * FROM (
        VALUES ('value1', 42), ('value2', 12)
    ) AS t (my_text, my_number);
            </code></pre>

            <table>
                <tr>
                    <th>my_text</th>
                    <th>my_number</th>
                </tr>
                <tr>
                    <td>value1</td>
                    <td>42</td>
                </tr>
                <tr>
                    <td>value2</td>
                    <td>12</td>
                </tr>
            </table>

            Column aliases are not supported by MariaDB 10.3
        </section>

        <section class="top">
            <h3>JSON</h3>

            <h4>MySQL/MariaDB</h4>

            <pre><code class="sql">
    SELECT JSON_OBJECT('a', name, 'b', number) AS jayson FROM foo;
            </code></pre>

            <h4>PostgreSQL</h4>

            <pre><code class="sql">
    SELECT JSON_BUILD_OBJECT('a', name, 'b', number) AS jayson FROM foo;
            </code></pre>

            <table>
                <tr>
                    <th>jayson</th>
                </tr>
                <tr>
                    <td>{"a": "value1", "b": 42}</td>
                </tr>
            </table>
        </section>

        <section class="top">
            <h3>Common Table Expression (CTE)</h3>

            <pre><code class="sql">
    WITH bar (col1, col2) AS (SELECT id, content FROM foo)

    SELECT * FROM bar;
            </code></pre>
        </section>

        <section>
            <table>
                <tr>
                    <th>id</th>
                    <th>parent_id</th>
                    <th>name</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>NULL</td>
                    <td>A</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>NULL</td>
                    <td>B</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>NULL</td>
                    <td>C</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>2</td>
                    <td>B-1</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>1</td>
                    <td>A-1</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>2</td>
                    <td>B-2</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>1</td>
                    <td>A-2</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>5</td>
                    <td>A-1-1</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>5</td>
                    <td>A-1-2</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>8</td>
                    <td>A-1-1-1</td>
                </tr>

            </table>
        </section>

        <section class="top">
            <h3>With Recursive</h3>

            <pre><code class="sql">
    WITH RECURSIVE cat AS (
        SELECT * from category WHERE name = 'A'
        UNION ALL
        SELECT cat_recursive.* from category as cat_recursive
            JOIN cat AS parent ON parent.id = cat_recursive.parent_id
    )
    SELECT * FROM cat;
            </code></pre>
        </section>

        <section class="top">
            <h3>With Recursive</h3>
            <table>
                <tr>
                    <th>id</th>
                    <th>parent_id</th>
                    <th>name</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>NULL</td>
                    <td>A</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>1</td>
                    <td>A-1</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>1</td>
                    <td>A-2</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>5</td>
                    <td>A-1-1</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>5</td>
                    <td>A-1-2</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>8</td>
                    <td>A-1-1-1</td>
                </tr>

            </table>
        </section>

        <section>
            <h3>listagg</h3>

            <h4>SQL 2016 (and Oracle)</h4>
            <pre><code class="sql text-small">
    SELECT LISTAGG(name, ',') AS comma_separated FROM foo GROUP BY number;
            </code></pre>

            <h4>PostgreSQL / MSSQL</h4>
            <pre><code class="sql text-small">
    SELECT STRING_AGG(name, ',') AS comma_separated FROM foo GROUP BY number;
            </code></pre>

            <h4>MariaDB / MySQL</h4>
            <pre><code class="sql text-small">
    SELECT GROUP_CONCAT(name SEPARATOR ',') AS comma_separated FROM foo GROUP BY number;
            </code></pre>

            <table>
                <tr>
                    <th>comma_separated</th>
                </tr>
                <tr>
                    <td>Sebastian,Andreas</td>
                </tr>
            </table>
        </section>

        <section>
            <h2>You may not have the <strong>full</strong> power of SQL at your fingertips</h2>
        </section>

        <section data-background="../images/iceberg.jpg" class="top">
            <h3>This was just the tip of the iceberg</h3>
            <a class="credit-badge" href="https://unsplash.com/@anniespratt?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer">
                <span style="display:inline-block;padding:2px 3px">
                    <svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-1px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M20.8 18.1c0 2.7-2.2 4.8-4.8 4.8s-4.8-2.1-4.8-4.8c0-2.7 2.2-4.8 4.8-4.8 2.7.1 4.8 2.2 4.8 4.8zm11.2-7.4v14.9c0 2.3-1.9 4.3-4.3 4.3h-23.4c-2.4 0-4.3-1.9-4.3-4.3v-15c0-2.3 1.9-4.3 4.3-4.3h3.7l.8-2.3c.4-1.1 1.7-2 2.9-2h8.6c1.2 0 2.5.9 2.9 2l.8 2.4h3.7c2.4 0 4.3 1.9 4.3 4.3zm-8.6 7.5c0-4.1-3.3-7.5-7.5-7.5-4.1 0-7.5 3.4-7.5 7.5s3.3 7.5 7.5 7.5c4.2-.1 7.5-3.4 7.5-7.5z"></path></svg>
                </span><span style="display:inline-block;padding:2px 3px">Annie Spratt</span>
            </a>
        </section>

        <section>
            <h2>Know your database!</h2>
        </section>

        <!-- ending -->

        <section>
            <h2>SQL queries need reviews like any other code</h2>
        </section>

        <section class="top">
            <h3>Dev Toolbar</h3>

            <img src="../images/toolbar2.png" class="transparent">
        </section>

        <section>
            <h3>Dev Toolbar</h3>

            <img src="../images/toolbar1.png" class="transparent">
        </section>

        <section data-background="../images/pmm1.png">

            <aside class="notes">
                Percona Monitoring and Management Tool
            </aside>
        </section>

        <section data-background="../images/pmm2.png">

            <aside class="notes">
                Percona Monitoring and Management Tool
            </aside>
        </section>

        <section data-background="../images/pmm3.png">

            <aside class="notes">
                Percona Monitoring and Management Tool
            </aside>
        </section>

        <section class="top">
            <h3>SQL fiddles</h3>

            <ul>
                <li><a href="https://dbfiddle.uk" rel="nofollow noreferrer" target="_blank">dbfiddle.uk</a></li>
                <li><a href="http://sqlfiddle.com" rel="nofollow noreferrer" target="_blank">sqlfiddle.com</a></li>
            </ul>
        </section>

        <section>
            <h3>SQL books</h3>

            <div class="table">
                <div>
                    <div style="text-align: center"><img src="../images/sql-mere-mortals.jpg" height="600"></div>
                    <div style="text-align: center"><img src="../images/sql-performance-explained.jpg" height="600"></div>
                </div>
            </div>
        </section>

        <section class="top">
            <h2>Thank you</h2>
            <h3>What are your questions?</h3>
            <div class="text-small">
                Claudio Zizza<br>
                <a rel="nofollow noreferrer" target="_blank" href="https://twitter.com/senseexception">@SenseException</a>
            </div>
        </section>
    </div>
</div>


<script src="../node_modules/reveal.js/js/reveal.js"></script>
<script src="../node_modules/reveal.js/lib/js/head.min.js"></script>
<script type="text/javascript" src="../node_modules/reveal.js/plugin/highlight/highlight.js"></script>
<script type="application/javascript">
    Reveal.initialize({

        dependencies: [
            { src: '../node_modules/reveal.js/plugin/notes/notes.js', async: true }
        ],
        center: true,

        width: 1200,
        height: 800,

        minScale: 1.0,
        maxScale: 10.0,

        rollingLinks: true,
        transition: 'linear' // default/cube/page/concave/zoom/linear/fade/none
    });
</script>
<script type="text/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
